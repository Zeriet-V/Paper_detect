# è®ºæ–‡æ ¼å¼æ£€æµ‹ç³»ç»Ÿ - æ•°æ®å±‚è®¾è®¡

## ğŸ“‹ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è¡¨ç¤ºå±‚ (UI)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç™»å½•ç•Œé¢ â”‚ ç¨¿ä»¶ç®¡ç† â”‚ æ ¼å¼æ£€æµ‹ â”‚ æŠ¥å‘Šç”Ÿæˆ â”‚ æ¨¡æ¿ä¸Šä¼  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¸šåŠ¡å±‚ (Logic)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·è®¤è¯ â”‚ ç¨¿ä»¶ç®¡ç† â”‚ æ ¼å¼æ£€æµ‹ â”‚ æŠ¥å‘Šç”Ÿæˆ â”‚ æ¨¡æ¿ç®¡ç† â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®å±‚ (Data)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·è¡¨  â”‚  ç¨¿ä»¶è¡¨  â”‚  æ£€æµ‹è¡¨  â”‚  æŠ¥å‘Šè¡¨  â”‚  æ¨¡æ¿è¡¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡

### 1. ç”¨æˆ·ç®¡ç†æ¨¡å—

#### 1.1 users - ç”¨æˆ·è¡¨
```sql
CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    real_name VARCHAR(100),
    role ENUM('admin', 'editor', 'reviewer', 'author') DEFAULT 'author',
    status ENUM('active', 'inactive', 'locked') DEFAULT 'active',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_login DATETIME,
    INDEX idx_username (username),
    INDEX idx_email (email)
);
```

**å­—æ®µè¯´æ˜**ï¼š
- `user_id`: ç”¨æˆ·å”¯ä¸€æ ‡è¯†
- `username`: ç™»å½•ç”¨æˆ·å
- `password_hash`: å¯†ç å“ˆå¸Œï¼ˆä½¿ç”¨bcryptï¼‰
- `role`: è§’è‰²ï¼ˆç®¡ç†å‘˜/ç¼–è¾‘/å®¡ç¨¿äºº/ä½œè€…ï¼‰
- `status`: è´¦æˆ·çŠ¶æ€

#### 1.2 sessions - ä¼šè¯è¡¨
```sql
CREATE TABLE sessions (
    session_id VARCHAR(64) PRIMARY KEY,
    user_id INT NOT NULL,
    token VARCHAR(255) NOT NULL,
    expires_at DATETIME NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    INDEX idx_token (token),
    INDEX idx_user_id (user_id)
);
```

---

### 2. ç¨¿ä»¶ç®¡ç†æ¨¡å—

#### 2.1 manuscripts - ç¨¿ä»¶è¡¨
```sql
CREATE TABLE manuscripts (
    manuscript_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    title VARCHAR(500),
    author_names TEXT,
    upload_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_modified DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    status ENUM('uploaded', 'detecting', 'detected', 'approved', 'rejected') DEFAULT 'uploaded',
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size BIGINT,
    file_hash VARCHAR(64),
    current_version INT DEFAULT 1,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_upload_time (upload_time)
);
```

**å­—æ®µè¯´æ˜**ï¼š
- `manuscript_id`: ç¨¿ä»¶å”¯ä¸€æ ‡è¯†
- `user_id`: ä¸Šä¼ ç”¨æˆ·
- `title`: è®ºæ–‡æ ‡é¢˜
- `author_names`: ä½œè€…å§“åï¼ˆä»æ–‡æ¡£ä¸­æå–ï¼‰
- `status`: ç¨¿ä»¶çŠ¶æ€
- `file_hash`: æ–‡ä»¶MD5ï¼Œç”¨äºå»é‡å’Œç‰ˆæœ¬å¯¹æ¯”

#### 2.2 manuscript_versions - ç¨¿ä»¶ç‰ˆæœ¬è¡¨
```sql
CREATE TABLE manuscript_versions (
    version_id INT PRIMARY KEY AUTO_INCREMENT,
    manuscript_id INT NOT NULL,
    version_number INT NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_hash VARCHAR(64),
    upload_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    upload_by INT NOT NULL,
    change_description TEXT,
    FOREIGN KEY (manuscript_id) REFERENCES manuscripts(manuscript_id),
    FOREIGN KEY (upload_by) REFERENCES users(user_id),
    UNIQUE KEY uk_manuscript_version (manuscript_id, version_number),
    INDEX idx_manuscript_id (manuscript_id)
);
```

---

### 3. æ ¼å¼æ£€æµ‹æ¨¡å—

#### 3.1 detection_tasks - æ£€æµ‹ä»»åŠ¡è¡¨
```sql
CREATE TABLE detection_tasks (
    task_id VARCHAR(64) PRIMARY KEY,
    manuscript_id INT NOT NULL,
    version_id INT,
    detection_type VARCHAR(50),  -- 'full', 'figure_only', 'quick', etc.
    status ENUM('pending', 'processing', 'completed', 'failed') DEFAULT 'pending',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    started_at DATETIME,
    completed_at DATETIME,
    enable_figure_api BOOLEAN DEFAULT FALSE,
    error_message TEXT,
    FOREIGN KEY (manuscript_id) REFERENCES manuscripts(manuscript_id),
    FOREIGN KEY (version_id) REFERENCES manuscript_versions(version_id),
    INDEX idx_manuscript_id (manuscript_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
);
```

**å­—æ®µè¯´æ˜**ï¼š
- `task_id`: ä»»åŠ¡UUID
- `detection_type`: æ£€æµ‹ç±»å‹ï¼ˆå®Œæ•´æ£€æµ‹/ä»…å›¾ç‰‡/å¿«é€Ÿæ£€æµ‹ï¼‰
- `enable_figure_api`: æ˜¯å¦å¯ç”¨å›¾ç‰‡å†…å®¹APIæ£€æµ‹

#### 3.2 detection_results - æ£€æµ‹ç»“æœè¡¨
```sql
CREATE TABLE detection_results (
    result_id INT PRIMARY KEY AUTO_INCREMENT,
    task_id VARCHAR(64) NOT NULL,
    module_name VARCHAR(50) NOT NULL,  -- 'Title', 'Abstract', 'Figure', etc.
    overall_status ENUM('pass', 'fail', 'warning') DEFAULT 'pass',
    total_checks INT DEFAULT 0,
    passed_checks INT DEFAULT 0,
    failed_checks INT DEFAULT 0,
    result_json JSON,  -- å®Œæ•´çš„æ£€æµ‹ç»“æœJSON
    FOREIGN KEY (task_id) REFERENCES detection_tasks(task_id),
    INDEX idx_task_id (task_id),
    INDEX idx_module_name (module_name)
);
```

#### 3.3 detection_issues - æ£€æµ‹é—®é¢˜æ˜ç»†è¡¨
```sql
CREATE TABLE detection_issues (
    issue_id INT PRIMARY KEY AUTO_INCREMENT,
    result_id INT NOT NULL,
    issue_category VARCHAR(100),  -- 'format', 'alignment', 'numbering', etc.
    issue_type VARCHAR(100),
    severity ENUM('error', 'warning', 'info') DEFAULT 'error',
    description TEXT NOT NULL,
    location_method VARCHAR(50),  -- 'keyword', 'index', 'paragraph'
    location_data VARCHAR(500),
    paragraph_index INT,
    is_resolved BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (result_id) REFERENCES detection_results(result_id),
    INDEX idx_result_id (result_id),
    INDEX idx_severity (severity)
);
```

---

### 4. å›¾ç‰‡å¤„ç†æ¨¡å—

#### 4.1 extracted_figures - æå–çš„å›¾ç‰‡è¡¨
```sql
CREATE TABLE extracted_figures (
    figure_id INT PRIMARY KEY AUTO_INCREMENT,
    task_id VARCHAR(64) NOT NULL,
    manuscript_id INT NOT NULL,
    figure_index INT NOT NULL,  -- ç¬¬å‡ å¼ å›¾ç‰‡
    figure_number INT,  -- Fig.ç¼–å·ï¼ˆå¦‚æœæœ‰æ ‡é¢˜ï¼‰
    has_caption BOOLEAN DEFAULT FALSE,
    caption_text TEXT,
    image_path VARCHAR(500) NOT NULL,
    image_format VARCHAR(10),  -- 'jpg', 'png', etc.
    image_size BIGINT,
    paragraph_index INT,
    extracted_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (task_id) REFERENCES detection_tasks(task_id),
    FOREIGN KEY (manuscript_id) REFERENCES manuscripts(manuscript_id),
    INDEX idx_task_id (task_id),
    INDEX idx_manuscript_id (manuscript_id)
);
```

#### 4.2 figure_content_checks - å›¾ç‰‡å†…å®¹æ£€æµ‹è¡¨
```sql
CREATE TABLE figure_content_checks (
    check_id INT PRIMARY KEY AUTO_INCREMENT,
    figure_id INT NOT NULL,
    is_chart BOOLEAN DEFAULT FALSE,
    chart_type VARCHAR(50),
    overall_result ENUM('pass', 'fail', 'skip') DEFAULT 'skip',
    
    -- å„é¡¹æ£€æµ‹ç»“æœ
    tick_direction_ok BOOLEAN,
    tick_direction_desc TEXT,
    
    unit_format_ok BOOLEAN,
    unit_format_issues JSON,
    
    unit_brackets_ok BOOLEAN,
    unit_brackets_issues JSON,
    
    decimal_consistency_ok BOOLEAN,
    decimal_consistency_desc TEXT,
    
    axis_title_consistency_ok BOOLEAN,
    axis_title_desc TEXT,
    
    api_response_json JSON,  -- å®Œæ•´APIå“åº”
    checked_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (figure_id) REFERENCES extracted_figures(figure_id),
    INDEX idx_figure_id (figure_id)
);
```

---

### 5. æŠ¥å‘Šç®¡ç†æ¨¡å—

#### 5.1 detection_reports - æ£€æµ‹æŠ¥å‘Šè¡¨
```sql
CREATE TABLE detection_reports (
    report_id INT PRIMARY KEY AUTO_INCREMENT,
    task_id VARCHAR(64) NOT NULL UNIQUE,
    manuscript_id INT NOT NULL,
    
    -- æŠ¥å‘Šæ–‡ä»¶
    text_report_path VARCHAR(500),
    annotated_doc_path VARCHAR(500),
    json_report_path VARCHAR(500),
    
    -- ç»Ÿè®¡ä¿¡æ¯
    total_modules INT DEFAULT 0,
    passed_modules INT DEFAULT 0,
    total_issues INT DEFAULT 0,
    
    -- æ±‡æ€»ç»Ÿè®¡
    title_status ENUM('pass', 'fail', 'skip'),
    abstract_status ENUM('pass', 'fail', 'skip'),
    keywords_status ENUM('pass', 'fail', 'skip'),
    content_status ENUM('pass', 'fail', 'skip'),
    formula_status ENUM('pass', 'fail', 'skip'),
    figure_status ENUM('pass', 'fail', 'skip'),
    table_status ENUM('pass', 'fail', 'skip'),
    
    overall_pass_rate DECIMAL(5,2),
    
    generated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (task_id) REFERENCES detection_tasks(task_id),
    FOREIGN KEY (manuscript_id) REFERENCES manuscripts(manuscript_id),
    INDEX idx_manuscript_id (manuscript_id),
    INDEX idx_generated_at (generated_at)
);
```

---

### 6. æ¨¡æ¿ç®¡ç†æ¨¡å—

#### 6.1 detection_templates - æ£€æµ‹æ¨¡æ¿è¡¨
```sql
CREATE TABLE detection_templates (
    template_id INT PRIMARY KEY AUTO_INCREMENT,
    template_name VARCHAR(100) NOT NULL,
    template_type VARCHAR(50) NOT NULL,  -- 'Title', 'Abstract', 'Figure', etc.
    config_json JSON NOT NULL,  -- JSONé…ç½®å†…å®¹
    is_default BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_by INT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    version INT DEFAULT 1,
    description TEXT,
    FOREIGN KEY (created_by) REFERENCES users(user_id),
    INDEX idx_template_type (template_type),
    INDEX idx_is_default (is_default)
);
```

#### 6.2 template_history - æ¨¡æ¿å†å²ç‰ˆæœ¬è¡¨
```sql
CREATE TABLE template_history (
    history_id INT PRIMARY KEY AUTO_INCREMENT,
    template_id INT NOT NULL,
    version_number INT NOT NULL,
    config_json JSON NOT NULL,
    modified_by INT,
    modified_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    change_description TEXT,
    FOREIGN KEY (template_id) REFERENCES detection_templates(template_id),
    FOREIGN KEY (modified_by) REFERENCES users(user_id),
    UNIQUE KEY uk_template_version (template_id, version_number)
);
```

---

### 7. APIä½¿ç”¨ç®¡ç†æ¨¡å—

#### 7.1 api_usage - APIè°ƒç”¨è®°å½•è¡¨
```sql
CREATE TABLE api_usage (
    usage_id INT PRIMARY KEY AUTO_INCREMENT,
    task_id VARCHAR(64) NOT NULL,
    figure_id INT,
    api_type VARCHAR(50) DEFAULT 'siliconflow',
    model_name VARCHAR(100),
    check_type VARCHAR(50),  -- 'is_chart', 'tick_direction', etc.
    
    request_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    response_time DATETIME,
    duration_ms INT,  -- å“åº”æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
    
    status ENUM('success', 'failed', 'timeout') DEFAULT 'success',
    error_message TEXT,
    
    tokens_used INT,
    estimated_cost DECIMAL(10,4),
    
    FOREIGN KEY (task_id) REFERENCES detection_tasks(task_id),
    FOREIGN KEY (figure_id) REFERENCES extracted_figures(figure_id),
    INDEX idx_task_id (task_id),
    INDEX idx_request_time (request_time)
);
```

---

### 8. ç³»ç»Ÿé…ç½®æ¨¡å—

#### 8.1 system_config - ç³»ç»Ÿé…ç½®è¡¨
```sql
CREATE TABLE system_config (
    config_id INT PRIMARY KEY AUTO_INCREMENT,
    config_key VARCHAR(100) UNIQUE NOT NULL,
    config_value TEXT,
    config_type VARCHAR(50),  -- 'string', 'number', 'boolean', 'json'
    description TEXT,
    is_sensitive BOOLEAN DEFAULT FALSE,  -- æ˜¯å¦ä¸ºæ•æ„Ÿé…ç½®ï¼ˆå¦‚APIå¯†é’¥ï¼‰
    updated_by INT,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (updated_by) REFERENCES users(user_id)
);
```

**é¢„è®¾é…ç½®é¡¹**ï¼š
```sql
INSERT INTO system_config (config_key, config_value, config_type, description) VALUES
('api.siliconflow.key', '', 'string', 'ç¡…åŸºæµåŠ¨APIå¯†é’¥'),
('api.siliconflow.model', 'Qwen/Qwen3-VL-32B-Instruct', 'string', 'è§†è§‰æ¨¡å‹åç§°'),
('figure.save_images', 'true', 'boolean', 'æ˜¯å¦ä¿å­˜æå–çš„å›¾ç‰‡'),
('figure.enable_api_by_default', 'false', 'boolean', 'é»˜è®¤æ˜¯å¦å¯ç”¨APIæ£€æµ‹'),
('storage.upload_dir', 'uploads', 'string', 'ç¨¿ä»¶ä¸Šä¼ ç›®å½•'),
('storage.result_dir', 'results', 'string', 'æ£€æµ‹ç»“æœç›®å½•');
```

---

## ğŸ“Š æ•°æ®è¡¨å…³ç³»å›¾

```
users (ç”¨æˆ·)
  â”œâ”€â†’ manuscripts (ç¨¿ä»¶)
  â”‚     â”œâ”€â†’ manuscript_versions (ç¨¿ä»¶ç‰ˆæœ¬)
  â”‚     â”œâ”€â†’ detection_tasks (æ£€æµ‹ä»»åŠ¡)
  â”‚     â”‚     â”œâ”€â†’ detection_results (æ£€æµ‹ç»“æœ)
  â”‚     â”‚     â”‚     â””â”€â†’ detection_issues (é—®é¢˜æ˜ç»†)
  â”‚     â”‚     â”œâ”€â†’ detection_reports (æ£€æµ‹æŠ¥å‘Š)
  â”‚     â”‚     â”œâ”€â†’ extracted_figures (æå–çš„å›¾ç‰‡)
  â”‚     â”‚     â”‚     â””â”€â†’ figure_content_checks (å›¾ç‰‡å†…å®¹æ£€æµ‹)
  â”‚     â”‚     â””â”€â†’ api_usage (APIä½¿ç”¨è®°å½•)
  â”‚     â””â”€â†’ detection_reports (å…³è”)
  â”‚
  â”œâ”€â†’ detection_templates (æ¨¡æ¿)
  â”‚     â””â”€â†’ template_history (æ¨¡æ¿å†å²)
  â”‚
  â””â”€â†’ sessions (ä¼šè¯)
```

---

## ğŸ“‹ æ ¸å¿ƒæ•°æ®å®ä½“æ€»ç»“

### åŸºç¡€æ•°æ®ï¼ˆ8ä¸ªæ ¸å¿ƒè¡¨ï¼‰
1. **users** - ç”¨æˆ·ä¿¡æ¯
2. **manuscripts** - ç¨¿ä»¶åŸºæœ¬ä¿¡æ¯
3. **detection_tasks** - æ£€æµ‹ä»»åŠ¡
4. **detection_results** - æ£€æµ‹ç»“æœ
5. **detection_reports** - æ£€æµ‹æŠ¥å‘Š
6. **extracted_figures** - æå–çš„å›¾ç‰‡
7. **detection_templates** - æ£€æµ‹æ¨¡æ¿
8. **system_config** - ç³»ç»Ÿé…ç½®

### æ‰©å±•æ•°æ®ï¼ˆ5ä¸ªè¾…åŠ©è¡¨ï¼‰
9. **sessions** - ç”¨æˆ·ä¼šè¯
10. **manuscript_versions** - ç¨¿ä»¶ç‰ˆæœ¬
11. **detection_issues** - é—®é¢˜æ˜ç»†
12. **figure_content_checks** - å›¾ç‰‡å†…å®¹æ£€æµ‹è¯¦æƒ…
13. **api_usage** - APIè°ƒç”¨è®°å½•
14. **template_history** - æ¨¡æ¿å†å²

---

## ğŸ”„ å…¸å‹ä¸šåŠ¡æµç¨‹çš„æ•°æ®æµ

### æµç¨‹1ï¼šä¸Šä¼ ç¨¿ä»¶å¹¶æ£€æµ‹

```
1. ç”¨æˆ·ç™»å½•
   â†’ INSERT INTO sessions

2. ä¸Šä¼ ç¨¿ä»¶
   â†’ INSERT INTO manuscripts
   â†’ INSERT INTO manuscript_versions (v1)
   â†’ ä¿å­˜æ–‡ä»¶åˆ° uploads/

3. å¯åŠ¨æ£€æµ‹
   â†’ INSERT INTO detection_tasks (status='pending')
   â†’ åå°å¤„ç†ï¼šstatus='processing'

4. æ‰§è¡Œæ£€æµ‹
   â†’ è°ƒç”¨å„æ£€æµ‹æ¨¡å—
   â†’ INSERT INTO detection_results (7æ¡ï¼Œå¯¹åº”7ä¸ªæ¨¡å—)
   â†’ INSERT INTO detection_issues (æ¯ä¸ªé—®é¢˜ä¸€æ¡)
   â†’ å¦‚æœæœ‰å›¾ç‰‡ï¼š
       â†’ INSERT INTO extracted_figures
       â†’ ä¿å­˜å›¾ç‰‡åˆ° extracted_figures/
       â†’ å¦‚æœå¯ç”¨APIï¼š
           â†’ INSERT INTO figure_content_checks
           â†’ INSERT INTO api_usage (æ¯æ¬¡APIè°ƒç”¨)

5. ç”ŸæˆæŠ¥å‘Š
   â†’ ç”Ÿæˆæ–‡æœ¬æŠ¥å‘Šã€æ‰¹æ³¨æ–‡æ¡£
   â†’ INSERT INTO detection_reports
   â†’ ä¿å­˜æŠ¥å‘Šæ–‡ä»¶åˆ° results/
   â†’ UPDATE detection_tasks SET status='completed'

6. ç”¨æˆ·æŸ¥çœ‹æŠ¥å‘Š
   â†’ SELECT FROM detection_reports
   â†’ ä¸‹è½½æ–‡æœ¬æŠ¥å‘Šã€æ‰¹æ³¨æ–‡æ¡£
```

### æµç¨‹2ï¼šä¸Šä¼ æ–°ç‰ˆæœ¬ç¨¿ä»¶

```
1. ç”¨æˆ·ä¸Šä¼ ä¿®æ”¹åçš„ç¨¿ä»¶
   â†’ INSERT INTO manuscript_versions (v2)
   â†’ UPDATE manuscripts SET current_version=2

2. é‡æ–°æ£€æµ‹
   â†’ INSERT INTO detection_tasks (version_id=v2)
   â†’ æ‰§è¡Œæ£€æµ‹...
   â†’ å¯¹æ¯”v1å’Œv2çš„æ£€æµ‹ç»“æœ
```

### æµç¨‹3ï¼šæ¨¡æ¿ç®¡ç†

```
1. ç®¡ç†å‘˜ä¸Šä¼ æ–°æ¨¡æ¿
   â†’ INSERT INTO detection_templates
   
2. ä¿®æ”¹æ¨¡æ¿
   â†’ INSERT INTO template_history (ä¿ç•™å†å²)
   â†’ UPDATE detection_templates
   
3. åˆ‡æ¢é»˜è®¤æ¨¡æ¿
   â†’ UPDATE detection_templates SET is_default=FALSE WHERE template_type='Figure'
   â†’ UPDATE detection_templates SET is_default=TRUE WHERE template_id=X
```

---

## ğŸ’¾ æ–‡ä»¶å­˜å‚¨ç»“æ„

```
project_root/
â”œâ”€â”€ uploads/                    # ä¸Šä¼ çš„ç¨¿ä»¶
â”‚   â”œâ”€â”€ user_123/
â”‚   â”‚   â”œâ”€â”€ manuscript_456_v1.docx
â”‚   â”‚   â””â”€â”€ manuscript_456_v2.docx
â”‚   â””â”€â”€ user_124/
â”‚
â”œâ”€â”€ results/                    # æ£€æµ‹ç»“æœ
â”‚   â”œâ”€â”€ task_abc123/
â”‚   â”‚   â”œâ”€â”€ report.txt
â”‚   â”‚   â”œâ”€â”€ annotated.docx
â”‚   â”‚   â””â”€â”€ report.json
â”‚   â””â”€â”€ task_def456/
â”‚
â”œâ”€â”€ extracted_figures/          # æå–çš„å›¾ç‰‡
â”‚   â”œâ”€â”€ task_abc123/
â”‚   â”‚   â”œâ”€â”€ manuscript_456_Fig1.jpg
â”‚   â”‚   â””â”€â”€ manuscript_456_Fig2.png
â”‚   â””â”€â”€ task_def456/
â”‚
â”œâ”€â”€ api_results/                # APIå“åº”
â”‚   â”œâ”€â”€ task_abc123_api_response.json
â”‚   â””â”€â”€ task_def456_api_response.json
â”‚
â””â”€â”€ templates/                  # æ£€æµ‹æ¨¡æ¿ï¼ˆJSONæ–‡ä»¶ï¼‰
    â”œâ”€â”€ default/
    â”‚   â”œâ”€â”€ Title.json
    â”‚   â”œâ”€â”€ Figure.json
    â”‚   â””â”€â”€ ...
    â””â”€â”€ custom/
        â””â”€â”€ user_templates/
```

---

## ğŸ¯ æ•°æ®é‡ä¼°ç®—

å‡è®¾ç³»ç»Ÿè§„æ¨¡ï¼š
- **ç”¨æˆ·æ•°**ï¼š100-1000
- **æ¯æœˆç¨¿ä»¶**ï¼š1000ç¯‡
- **æ¯ç¯‡æ£€æµ‹**ï¼š2-3æ¬¡ï¼ˆåˆæ£€+ä¿®æ”¹åå¤æ£€ï¼‰
- **æ¯ç¯‡å›¾ç‰‡**ï¼šå¹³å‡5å¼ 

**å¹´æ•°æ®é‡**ï¼š
- manuscripts: ~12,000æ¡
- detection_tasks: ~30,000æ¡
- detection_results: ~210,000æ¡ï¼ˆ30k Ã— 7æ¨¡å—ï¼‰
- extracted_figures: ~150,000æ¡ï¼ˆ30k Ã— 5å›¾/ç¯‡ï¼‰
- figure_content_checks: ~150,000æ¡ï¼ˆå¦‚æœå¯ç”¨APIï¼‰

**å­˜å‚¨éœ€æ±‚**ï¼š
- æ•°æ®åº“ï¼š< 5GB/å¹´
- æ–‡ä»¶å­˜å‚¨ï¼š~100GB/å¹´ï¼ˆç¨¿ä»¶+å›¾ç‰‡+æŠ¥å‘Šï¼‰

---

## ğŸ” å®‰å…¨è€ƒè™‘

### æ•æ„Ÿæ•°æ®å¤„ç†
1. **å¯†ç **ï¼šä½¿ç”¨bcryptå“ˆå¸Œï¼Œä¸å­˜æ˜æ–‡
2. **APIå¯†é’¥**ï¼šåŠ å¯†å­˜å‚¨åœ¨system_configï¼Œæ ‡è®°is_sensitive=TRUE
3. **æ–‡ä»¶éš”ç¦»**ï¼šæŒ‰ç”¨æˆ·IDåˆ†ç›®å½•å­˜å‚¨

### æƒé™æ§åˆ¶
1. **ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ç¨¿ä»¶**
2. **ç¼–è¾‘/å®¡ç¨¿äººå¯æŸ¥çœ‹åˆ†é…çš„ç¨¿ä»¶**
3. **ç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰æ•°æ®**
4. **æ¨¡æ¿ä¿®æ”¹ä»…é™ç®¡ç†å‘˜**

---

## ğŸš€ æ‰©å±•æ€§è®¾è®¡

### æ”¯æŒæœªæ¥åŠŸèƒ½
1. **æ‰¹é‡æ£€æµ‹**ï¼šä¸€æ¬¡ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
2. **å®šæ—¶æ£€æµ‹**ï¼šè®¾ç½®æ£€æµ‹é˜Ÿåˆ—
3. **å¯¹æ¯”æ£€æµ‹**ï¼šå¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„æ£€æµ‹ç»“æœ
4. **ç»Ÿè®¡åˆ†æ**ï¼šç”¨æˆ·/ç¨¿ä»¶/æ£€æµ‹çš„ç»Ÿè®¡å›¾è¡¨
5. **å¯¼å‡ºåŠŸèƒ½**ï¼šæ‰¹é‡å¯¼å‡ºæŠ¥å‘Šï¼ˆPDF/Excelï¼‰

### æ€§èƒ½ä¼˜åŒ–
1. **ç´¢å¼•ä¼˜åŒ–**ï¼šå·²åœ¨å…³é”®å­—æ®µæ·»åŠ ç´¢å¼•
2. **åˆ†åŒºè¡¨**ï¼šå¯æŒ‰æ—¶é—´åˆ†åŒºï¼ˆdetection_tasks, api_usageï¼‰
3. **ç¼“å­˜å±‚**ï¼šRedisç¼“å­˜æ£€æµ‹ç»“æœã€æ¨¡æ¿é…ç½®
4. **å¼‚æ­¥å¤„ç†**ï¼šæ£€æµ‹ä»»åŠ¡ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆCeleryï¼‰

---

è¿™ä¸ªè®¾è®¡å®Œæ•´å—ï¼Ÿéœ€è¦æˆ‘ä¸ºæ‚¨ç”Ÿæˆæ•°æ®åº“åˆ›å»ºè„šæœ¬æˆ–è¯¦ç»†çš„APIæ¥å£è®¾è®¡æ–‡æ¡£å—ï¼Ÿ


