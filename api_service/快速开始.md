# è®ºæ–‡æ ¼å¼æ£€æµ‹ç³»ç»Ÿ API - å¿«é€Ÿå¼€å§‹

## ğŸš€ ä¸€åˆ†é’Ÿå¯åŠ¨

### æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

åŒå‡»è¿è¡Œ `start_api.bat` æ–‡ä»¶å³å¯å¯åŠ¨æœåŠ¡ã€‚

### æ–¹æ³•2: å‘½ä»¤è¡Œå¯åŠ¨

```bash
# 1. å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
pip install -r requirements.txt

# 2. å¯åŠ¨APIæœåŠ¡
python api.py
```

æœåŠ¡å¯åŠ¨åï¼Œä½ ä¼šçœ‹åˆ°ï¼š
```
è®ºæ–‡æ ¼å¼æ£€æµ‹ç³»ç»Ÿ API æœåŠ¡
========================================
å¯åŠ¨æœåŠ¡å™¨...
APIæ–‡æ¡£: http://localhost:8000/docs
========================================
```

## ğŸ“ ä¸‰ç§ä½¿ç”¨æ–¹å¼

### 1ï¸âƒ£ ä½¿ç”¨Webç•Œé¢ï¼ˆæœ€ç®€å•ï¼‰

1. ç¡®ä¿APIæœåŠ¡å·²å¯åŠ¨
2. ç”¨æµè§ˆå™¨æ‰“å¼€ `web_demo.html` æ–‡ä»¶
3. æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ Wordæ–‡æ¡£
4. ç­‰å¾…æ£€æµ‹å®Œæˆï¼Œä¸‹è½½ç»“æœ

### 2ï¸âƒ£ ä½¿ç”¨æµ‹è¯•å®¢æˆ·ç«¯

```bash
python test_api_client.py template/test.docx
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- ä¸Šä¼ æ–‡æ¡£
- ç­‰å¾…æ£€æµ‹
- ä¸‹è½½æŠ¥å‘Šå’Œå¸¦æ‰¹æ³¨çš„æ–‡æ¡£

### 3ï¸âƒ£ ä½¿ç”¨APIæ¥å£ï¼ˆä¾›ç³»ç»Ÿé›†æˆï¼‰

è¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹ `API_README.md`

Pythonç¤ºä¾‹ï¼š
```python
import requests
import time

# ä¸Šä¼ æ–‡æ¡£
files = {"file": open("test.docx", "rb")}
response = requests.post("http://localhost:8000/api/detect", files=files)
task_id = response.json()["task_id"]

# æŸ¥è¯¢çŠ¶æ€
while True:
    response = requests.get(f"http://localhost:8000/api/status/{task_id}")
    status = response.json()
    
    if status["status"] == "completed":
        print(f"é€šè¿‡ç‡: {status['result']['pass_rate']}%")
        break
    
    time.sleep(2)

# ä¸‹è½½ç»“æœ
report_url = f"http://localhost:8000/api/download/{task_id}/report"
annotated_url = f"http://localhost:8000/api/download/{task_id}/annotated"
```

## ğŸŒ åœ¨çº¿APIæ–‡æ¡£

å¯åŠ¨æœåŠ¡åè®¿é—®ï¼š

- **Swagger UI**: http://localhost:8000/docs
  - äº¤äº’å¼APIæ–‡æ¡£
  - å¯ä»¥ç›´æ¥æµ‹è¯•API
  
- **ReDoc**: http://localhost:8000/redoc
  - ç¾è§‚çš„æ–‡æ¡£å±•ç¤º

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶è¯´æ˜

```
paper_detect/
â”œâ”€â”€ api.py                      # APIæœåŠ¡ä¸»æ–‡ä»¶
â”œâ”€â”€ start_api.bat              # å¯åŠ¨è„šæœ¬ï¼ˆWindowsï¼‰
â”œâ”€â”€ web_demo.html              # Webæµ‹è¯•ç•Œé¢
â”œâ”€â”€ test_api_client.py         # Pythonæµ‹è¯•å®¢æˆ·ç«¯
â”œâ”€â”€ requirements.txt           # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ API_README.md              # è¯¦ç»†APIæ–‡æ¡£
â”œâ”€â”€ å¿«é€Ÿå¼€å§‹.md                 # æœ¬æ–‡ä»¶
â”œâ”€â”€ run_all_detections.py      # æ ¸å¿ƒæ£€æµ‹é€»è¾‘
â”œâ”€â”€ paper_detect/              # æ£€æµ‹æ¨¡å—
â”‚   â”œâ”€â”€ Title_detect.py
â”‚   â”œâ”€â”€ Abstract_detect.py
â”‚   â”œâ”€â”€ Keywords_detect.py
â”‚   â”œâ”€â”€ Content_detect.py
â”‚   â”œâ”€â”€ Formula_detect.py
â”‚   â””â”€â”€ Table_detect.py
â””â”€â”€ templates/                 # æ£€æµ‹è§„åˆ™æ¨¡æ¿
    â”œâ”€â”€ Title.json
    â”œâ”€â”€ Abstract.json
    â”œâ”€â”€ Keywords.json
    â”œâ”€â”€ Content.json
    â”œâ”€â”€ Formula.json
    â””â”€â”€ Table.json
```

## ğŸ”§ é…ç½®

### ä¿®æ”¹ç«¯å£

ç¼–è¾‘ `api.py` æœ€åä¸€è¡Œï¼š
```python
uvicorn.run(app, host="0.0.0.0", port=8080, reload=True)  # æ”¹ä¸º8080
```

### å…è®¸ç‰¹å®šåŸŸåè®¿é—®ï¼ˆCORSï¼‰

ç¼–è¾‘ `api.py` ä¸­çš„CORSé…ç½®ï¼š
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://yourdomain.com"],  # æŒ‡å®šåŸŸå
    ...
)
```

## â“ å¸¸è§é—®é¢˜

### Q: å¯åŠ¨æ—¶æç¤ºç¼ºå°‘ä¾èµ–ï¼Ÿ
A: è¿è¡Œ `pip install -r requirements.txt` å®‰è£…æ‰€æœ‰ä¾èµ–

### Q: ç«¯å£8000å·²è¢«å ç”¨ï¼Ÿ
A: ä¿®æ”¹ `api.py` ä¸­çš„ç«¯å£å·ï¼Œæˆ–å…³é—­å ç”¨8000ç«¯å£çš„ç¨‹åº

### Q: Webç•Œé¢æ— æ³•è¿æ¥APIï¼Ÿ
A: ç¡®ä¿ï¼š
1. APIæœåŠ¡å·²å¯åŠ¨ï¼ˆhttp://localhost:8000/api/health è¿”å›æ­£å¸¸ï¼‰
2. Webç•Œé¢ä¸­çš„API_BASE_URLæ­£ç¡®ï¼ˆé»˜è®¤æ˜¯ http://localhost:8000ï¼‰

### Q: å¦‚ä½•é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿï¼Ÿ
A: æŸ¥çœ‹ `API_README.md` ä¸­çš„é›†æˆç¤ºä¾‹ï¼Œæˆ–è”ç³»å¼€å‘å›¢é˜Ÿ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- è¯¦ç»†APIæ–‡æ¡£: æŸ¥çœ‹ `API_README.md`
- åœ¨çº¿APIæ–‡æ¡£: http://localhost:8000/docs
- åŸå§‹å‘½ä»¤è¡Œå·¥å…·: `python run_all_detections.py <docxæ–‡ä»¶>`

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… å¯åŠ¨æœåŠ¡
2. âœ… æµ‹è¯•Webç•Œé¢æˆ–æµ‹è¯•å®¢æˆ·ç«¯
3. âœ… æŸ¥çœ‹APIæ–‡æ¡£
4. âœ… é›†æˆåˆ°ä½ çš„ç³»ç»Ÿä¸­

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰
