# 论文格式检测系统 API - 快速开始

## 🚀 一分钟启动

### 方法1: 使用启动脚本（推荐）

双击运行 `start_api.bat` 文件即可启动服务。

### 方法2: 命令行启动

```bash
# 1. 安装依赖（首次使用）
pip install -r requirements.txt

# 2. 启动API服务
python api.py
```

服务启动后，你会看到：
```
论文格式检测系统 API 服务
========================================
启动服务器...
API文档: http://localhost:8000/docs
========================================
```

## 📝 三种使用方式

### 1️⃣ 使用Web界面（最简单）

1. 确保API服务已启动
2. 用浏览器打开 `web_demo.html` 文件
3. 拖拽或点击上传Word文档
4. 等待检测完成，下载结果

### 2️⃣ 使用测试客户端

```bash
python test_api_client.py template/test.docx
```

这个脚本会自动完成：
- 上传文档
- 等待检测
- 下载报告和带批注的文档

### 3️⃣ 使用API接口（供系统集成）

详细文档请查看 `API_README.md`

Python示例：
```python
import requests
import time

# 上传文档
files = {"file": open("test.docx", "rb")}
response = requests.post("http://localhost:8000/api/detect", files=files)
task_id = response.json()["task_id"]

# 查询状态
while True:
    response = requests.get(f"http://localhost:8000/api/status/{task_id}")
    status = response.json()
    
    if status["status"] == "completed":
        print(f"通过率: {status['result']['pass_rate']}%")
        break
    
    time.sleep(2)

# 下载结果
report_url = f"http://localhost:8000/api/download/{task_id}/report"
annotated_url = f"http://localhost:8000/api/download/{task_id}/annotated"
```

## 🌐 在线API文档

启动服务后访问：

- **Swagger UI**: http://localhost:8000/docs
  - 交互式API文档
  - 可以直接测试API
  
- **ReDoc**: http://localhost:8000/redoc
  - 美观的文档展示

## 📂 项目文件说明

```
paper_detect/
├── api.py                      # API服务主文件
├── start_api.bat              # 启动脚本（Windows）
├── web_demo.html              # Web测试界面
├── test_api_client.py         # Python测试客户端
├── requirements.txt           # 依赖包列表
├── API_README.md              # 详细API文档
├── 快速开始.md                 # 本文件
├── run_all_detections.py      # 核心检测逻辑
├── paper_detect/              # 检测模块
│   ├── Title_detect.py
│   ├── Abstract_detect.py
│   ├── Keywords_detect.py
│   ├── Content_detect.py
│   ├── Formula_detect.py
│   └── Table_detect.py
└── templates/                 # 检测规则模板
    ├── Title.json
    ├── Abstract.json
    ├── Keywords.json
    ├── Content.json
    ├── Formula.json
    └── Table.json
```

## 🔧 配置

### 修改端口

编辑 `api.py` 最后一行：
```python
uvicorn.run(app, host="0.0.0.0", port=8080, reload=True)  # 改为8080
```

### 允许特定域名访问（CORS）

编辑 `api.py` 中的CORS配置：
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://yourdomain.com"],  # 指定域名
    ...
)
```

## ❓ 常见问题

### Q: 启动时提示缺少依赖？
A: 运行 `pip install -r requirements.txt` 安装所有依赖

### Q: 端口8000已被占用？
A: 修改 `api.py` 中的端口号，或关闭占用8000端口的程序

### Q: Web界面无法连接API？
A: 确保：
1. API服务已启动（http://localhost:8000/api/health 返回正常）
2. Web界面中的API_BASE_URL正确（默认是 http://localhost:8000）

### Q: 如何集成到现有系统？
A: 查看 `API_README.md` 中的集成示例，或联系开发团队

## 📞 技术支持

- 详细API文档: 查看 `API_README.md`
- 在线API文档: http://localhost:8000/docs
- 原始命令行工具: `python run_all_detections.py <docx文件>`

## 🎯 下一步

1. ✅ 启动服务
2. ✅ 测试Web界面或测试客户端
3. ✅ 查看API文档
4. ✅ 集成到你的系统中

祝使用愉快！🎉
