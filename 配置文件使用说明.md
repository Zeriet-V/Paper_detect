# 配置文件使用说明

## 📋 配置系统概述

现在系统支持通过配置文件管理API密钥和其他设置，无需在命令行中传递敏感信息。

## 🔧 快速开始

### 1. 创建配置文件

您的配置文件 `config_api.py` 已经创建好了：

```python
# config_api.py
SILICONFLOW_API_KEY = "sk-vverzmmnhjuobkiztovwgmgbjpnzmhfopyzluzjqukcoygha"
SILICONFLOW_API_BASE = "https://api.siliconflow.cn/v1"
SILICONFLOW_MODEL = "Qwen/Qwen3-VL-32B-Instruct"

ENABLE_FIGURE_CONTENT_CHECK = True  # 启用图片内容检测
SAVE_EXTRACTED_IMAGES = True  # 永久保存提取的图片
EXTRACTED_IMAGES_DIR = "extracted_figures"
```

⚠️ **重要**：`config_api.py` 已添加到 `.gitignore`，不会被提交到版本控制系统。

### 2. 测试配置

```bash
# 测试配置是否正确加载
python paper_detect/config_loader.py
```

输出示例：
```
✓ 已加载配置文件: D:\pyproject\paper_detect\config_api.py
配置项:
  API密钥: sk-vverzmmnhjuobkizt...
  API基础URL: https://api.siliconflow.cn/v1
  模型名称: Qwen/Qwen3-VL-32B-Instruct
  启用内容检测: True
  保存图片: True
  图片目录: extracted_figures
```

## 🚀 使用方式

### 方式1：完全自动（推荐）

直接运行，无需任何参数：

```bash
# 检测图片（自动从配置文件读取API密钥）
python test_figure_with_api.py template/test.docx
```

系统会：
1. 自动从 `config_api.py` 读取API密钥
2. 使用配置的模型名称
3. 按配置决定是否保存图片

### 方式2：命令行覆盖

也可以通过命令行参数覆盖配置：

```bash
# 使用不同的API密钥
python test_figure_with_api.py template/test.docx sk-another-key
```

优先级：**命令行参数 > 配置文件**

### 方式3：在代码中使用

```python
from paper_detect.Figure_content_detect import FigureContentDetector

# 自动从配置文件读取所有设置
detector = FigureContentDetector()

# 或者覆盖部分设置
detector = FigureContentDetector(save_images=False)  # 使用临时文件

# 完全自定义
detector = FigureContentDetector(
    api_key='sk-custom-key',
    model='other-model',
    save_images=True,
    image_dir='my_images'
)
```

## ⚙️ 配置项说明

### API相关

| 配置项 | 说明 | 默认值 |
|-------|------|--------|
| `SILICONFLOW_API_KEY` | API密钥 | 必填 |
| `SILICONFLOW_API_BASE` | API基础URL | `https://api.siliconflow.cn/v1` |
| `SILICONFLOW_MODEL` | 视觉模型名称 | `Qwen/Qwen3-VL-32B-Instruct` |

### 图片检测相关

| 配置项 | 说明 | 默认值 |
|-------|------|--------|
| `ENABLE_FIGURE_CONTENT_CHECK` | 是否启用图片内容检测 | `False` |
| `SAVE_EXTRACTED_IMAGES` | 是否永久保存提取的图片 | `True` |
| `EXTRACTED_IMAGES_DIR` | 图片保存目录 | `extracted_figures` |

## 📁 配置文件查找顺序

系统按以下顺序查找配置文件（找到第一个即停止）：

1. 项目根目录：`./config_api.py`
2. 当前工作目录：`$(pwd)/config_api.py`
3. 用户主目录：`~/.paper_detect_config.py`

## 🔒 安全建议

1. **不要将 `config_api.py` 提交到Git**
   - 已自动添加到 `.gitignore`
   - 包含敏感的API密钥

2. **团队协作**
   - 共享 `config_api.example.py`（模板文件）
   - 每个人维护自己的 `config_api.py`

3. **生产环境**
   - 使用环境变量或密钥管理系统
   - 不要在配置文件中硬编码生产密钥

## 📝 完整示例

### 示例1：基本使用

```python
from paper_detect.Figure_detect import check_doc_with_template

# 自动使用配置文件中的设置
result = check_doc_with_template(
    doc_path='paper.docx',
    template_identifier='Figure',
    enable_content_check=True  # 启用内容检测
)
```

### 示例2：覆盖配置

```python
from paper_detect.Figure_detect import check_doc_with_template

# 使用不同的API密钥
result = check_doc_with_template(
    doc_path='paper.docx',
    template_identifier='Figure',
    enable_content_check=True,
    api_key='sk-different-key'  # 覆盖配置文件中的密钥
)
```

### 示例3：代码中获取配置

```python
from paper_detect.config_loader import get_config, get_api_key

# 获取配置对象
config = get_config()

# 读取各项配置
api_key = config.api_key
model = config.model
save_images = config.save_images

# 或使用便捷函数
api_key = get_api_key()
```

## 🛠️ 故障排除

### 问题1：配置文件未找到

**错误信息**：
```
警告: 未找到配置文件 (config_api.py)
```

**解决方法**：
```bash
# 复制示例文件
cp config_api.example.py config_api.py

# 编辑并填入API密钥
# 在Windows上：
notepad config_api.py
```

### 问题2：API密钥未设置

**错误信息**：
```
未提供API密钥。请通过以下方式之一配置...
```

**解决方法**：
在 `config_api.py` 中设置正确的API密钥：
```python
SILICONFLOW_API_KEY = "sk-your-actual-key-here"
```

### 问题3：配置未生效

**检查步骤**：
```bash
# 1. 测试配置加载
python paper_detect/config_loader.py

# 2. 检查配置文件位置
python -c "from pathlib import Path; print('当前目录:', Path.cwd()); print('项目根目录:', Path(__file__).parent)"

# 3. 重新加载配置
python -c "from paper_detect.config_loader import get_config; config = get_config(reload=True); config.load()"
```

## 📚 相关文件

- `config_api.py` - 实际配置文件（不会提交到Git）
- `config_api.example.py` - 配置模板（可以提交到Git）
- `paper_detect/config_loader.py` - 配置加载器
- `.gitignore_addition.txt` - Git忽略规则

## 💡 最佳实践

1. **开发环境**
   - 使用本地 `config_api.py`
   - 定期更新 `config_api.example.py` 模板

2. **测试环境**
   - 使用测试专用的API密钥
   - 设置 `SAVE_EXTRACTED_IMAGES = False` 减少磁盘占用

3. **生产环境**
   - 从环境变量读取密钥
   - 使用密钥管理服务（如AWS Secrets Manager）

